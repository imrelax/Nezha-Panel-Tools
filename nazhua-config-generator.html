<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nazhua配置生成器 - 独立版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .config-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .v1-switch {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #f0f0f0;
        }

        .btn-primary {
            background: #409eff;
            color: white;
            border-color: #409eff;
        }

        .btn-primary:hover {
            background: #66b1ff;
        }

        .btn-warning {
            background: #e6a23c;
            color: white;
            border-color: #e6a23c;
        }

        .btn-warning:hover {
            background: #ebb563;
        }

        .form-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 6px;
        }

        .form-label {
            width: 150px;
            font-weight: 500;
            color: #606266;
            padding-top: 8px;
            flex-shrink: 0;
        }

        .version-tag {
            font-size: 10px;
            background: #f0f0f0;
            color: #666;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 5px;
        }

        .form-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .enable-switch {
            width: 50px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 22px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #409eff;
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .form-control {
            flex: 1;
            max-width: 300px;
        }

        .input, .select, .textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .input:focus, .select:focus, .textarea:focus {
            outline: none;
            border-color: #409eff;
            box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.2);
        }

        .remark {
            font-size: 12px;
            color: #409eff;
            margin-top: 5px;
            line-height: 1.4;
        }

        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 36px;
            align-items: center;
        }

        .tag {
            background: #f0f2f5;
            color: #606266;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag-remove {
            cursor: pointer;
            color: #999;
        }

        .tag-remove:hover {
            color: #f56c6c;
        }

        .tag-input input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .export-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .export-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .code-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .copy-btn {
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Nazhua配置生成器 - 独立版</h1>
            <p>基于原Vue项目的customConfig功能，提供纯HTML+JS实现</p>
        </div>

        <div class="config-panel">
            <div class="top-bar">
                <div class="v1-switch">
                    <span>是否用于哪吒V1控制台自定义代码？</span>
                    <label class="switch">
                        <input type="checkbox" id="v1CustomCode">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="button-group">
                    <button class="btn btn-warning" onclick="resetConfig()">还原默认配置</button>
                    <button class="btn btn-primary" onclick="showImportDialog()">导入配置</button>
                </div>
            </div>

            <div id="configForm">
                <!-- 配置项将通过JavaScript动态生成 -->
            </div>
        </div>

        <div class="export-section">
            <h3>生成的配置代码</h3>
            <div class="code-output" id="codeOutput">// 配置代码将在这里显示</div>
            <button class="btn btn-primary copy-btn" onclick="copyCode()">复制代码</button>
        </div>
    </div>

    <!-- 导入配置弹窗 -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">导入配置</div>
            <textarea id="importText" class="textarea" rows="10" placeholder="请粘贴配置代码"></textarea>
            <div class="modal-footer">
                <button class="btn" onclick="hideImportDialog()">取消</button>
                <button class="btn btn-primary" onclick="importConfig()">确定</button>
            </div>
        </div>
    </div>

    <script>
        // 配置模板数据
        const configTemplate = {
            title: '哪吒监控',
            customFavicon: '',
            footerSlogan: '',
            freeAmount: '白嫖',
            infinityCycle: '长期有效',
            buyBtnText: '购买',
            customBackgroundImage: '',
            lightBackground: false,
            showFireworks: true,
            showLantern: true,
            enableInnerSearch: true,
            listServerItemTypeToggle: true,
            listServerItemType: 'card',
            listServerStatusType: 'progress',
            listServerRealTimeShowLoad: false,
            detailServerStatusType: 'progress',
            simpleColorMode: false,
            serverStatusLinear: true,
            disableSarasaTermSC: true,
            hideWorldMap: false,
            hideHomeWorldMap: false,
            hideDetailWorldMap: false,
            homeWorldMapPosition: 'top',
            detailWorldMapPosition: 'top',
            hideNavbarServerCount: false,
            hideNavbarServerStat: false,
            hideListItemStatusDonut: false,
            hideListItemStat: false,
            hideListItemBill: false,
            hideFilter: false,
            hideTag: false,
            hideDotBG: false,
            monitorRefreshTime: 10,
            monitorChartType: 'multi',
            monitorChartTypeToggle: true,
            filterGPUKeywords: ['Virtual Display'],
            nezhaVersion: 'v0',
            apiMonitorPath: '/api/v1/monitor/{id}',
            wsPath: '/ws',
            nezhaPath: '/nezha/',
            nezhaV0ConfigType: 'servers',
            v1ApiMonitorPath: '/api/v1/service/{id}',
            v1WsPath: '/api/v1/ws/server',
            v1ApiGroupPath: '/api/v1/server-group',
            v1ApiSettingPath: '/api/v1/setting',
            v1ApiProfilePath: '/api/v1/profile',
            v1DashboardUrl: '/dashboard',
            v1HideNezhaDashboardBtn: false,
            routeMode: 'h5'
        };

        // 字段标签和配置
        const fieldLabels = {
            title: {
                label: '网站标题',
                placeholder: '请输入网站标题',
                remark: '默认显示为"哪吒探针"',
                type: 'input',
                v1customCode: true
            },
            customFavicon: {
                label: '自定义favicon',
                placeholder: '请输入自定义favicon地址',
                remark: '自定义favicon地址，建议您输入完整的图标地址',
                type: 'input',
                v1customCode: true,
                version: '0.5.7+'
            },
            footerSlogan: {
                label: '页脚标语',
                placeholder: '请输入页脚标语',
                remark: '留空不占位，支持HTML代码（不支持script标签动态代码）',
                type: 'input',
                v1customCode: true,
                version: '0.5.2+'
            },
            freeAmount: {
                label: '免费的叫啥',
                placeholder: '请输入免费服务的费用名称',
                remark: '默认显示为"免费"，万一你想叫它"白嫖"呢？',
                type: 'input',
                v1customCode: true
            },
            buyBtnText: {
                label: '购买按钮文案',
                placeholder: '请输入购买按钮文案',
                remark: '默认显示为"购买"，万一你想叫它"下单"呢？',
                type: 'input',
                v1customCode: true
            },
            infinityCycle: {
                label: '无限周期名称',
                placeholder: '请输入无限周期名称',
                remark: '默认显示为"长期有效"，万一你想叫它"永久"呢？',
                type: 'input',
                v1customCode: true
            },
            customBackgroundImage: {
                label: '自定义背景图片',
                placeholder: '请输入自定义背景图片地址',
                remark: '自定义背景图片地址，注意不要太大',
                type: 'input',
                v1customCode: true,
                version: '0.4.23+'
            },
            lightBackground: {
                label: '启用浅色背景',
                type: 'switch',
                remark: '启用浅色背景，会强制关闭点点背景，配合自定义背景图片使用',
                v1customCode: true,
                version: '0.4.23+'
            },
            showFireworks: {
                label: '启用烟花',
                type: 'switch',
                remark: '启用烟花，建议开启浅色背景',
                v1customCode: true,
                version: '0.5.1+'
            },
            showLantern: {
                label: '启用灯笼',
                type: 'switch',
                remark: '启用"新年快乐"灯笼',
                v1customCode: true,
                version: '0.5.1+'
            },
            enableInnerSearch: {
                label: '启用内部搜索',
                type: 'switch',
                remark: '启用内部搜索，默认启用',
                v1customCode: true,
                version: '0.5.4+'
            },
            listServerItemTypeToggle: {
                label: '列表项类型切换',
                type: 'switch',
                remark: '启用列表项类型切换，启用后列表项类型会显示为切换按钮，可以切换为卡片和行',
                v1customCode: true,
                version: '0.5.0+'
            },
            listServerItemType: {
                label: '列表项类型',
                placeholder: '请选择列表项类型',
                remark: '列表项的显示类型',
                type: 'select',
                options: [
                    { label: '卡片(card)', value: 'card' },
                    { label: '行(row)', value: 'row' }
                ],
                v1customCode: true
            },
            listServerStatusType: {
                label: '列表服务器状态类型',
                placeholder: '请选择列表服务器状态类型',
                remark: '列表页服务器状态的显示类型',
                type: 'select',
                options: [
                    { label: '进度条(progress)', value: 'progress' },
                    { label: '饼图(donut)', value: 'donut' }
                ],
                v1customCode: true
            },
            listServerRealTimeShowLoad: {
                label: '列表实时显示负载',
                type: 'switch',
                remark: '列表实时显示负载',
                v1customCode: true
            },
            detailServerStatusType: {
                label: '详情服务器状态类型',
                placeholder: '请选择详情服务器状态类型',
                remark: '详情页服务器状态的显示类型',
                type: 'select',
                options: [
                    { label: '进度条(progress)', value: 'progress' },
                    { label: '饼图(donut)', value: 'donut' }
                ],
                v1customCode: true
            },
            simpleColorMode: {
                label: '启用简约色系',
                type: 'switch',
                remark: '启用简约色系',
                v1customCode: true
            },
            serverStatusLinear: {
                label: '服务器状态渐变',
                type: 'switch',
                remark: '服务器状态渐变线性显示 - 与简约色系互斥',
                v1customCode: true
            },
            disableSarasaTermSC: {
                label: '禁用内置字体',
                type: 'switch',
                remark: '禁用Sarasa Term SC字体',
                v1customCode: true
            },
            hideWorldMap: {
                label: '隐藏地图',
                type: 'switch',
                remark: '隐藏地图后，首页和详情页都不会显示地图',
                v1customCode: true
            },
            hideHomeWorldMap: {
                label: '首页隐藏地图',
                type: 'switch',
                v1customCode: true
            },
            hideDetailWorldMap: {
                label: '详情页隐藏地图',
                type: 'switch',
                v1customCode: true
            },
            homeWorldMapPosition: {
                label: '首页地图位置',
                placeholder: '请选择首页地图位置',
                remark: '首页地图位置',
                type: 'select',
                options: [
                    { label: '顶部(top)', value: 'top' },
                    { label: '底部(bottom)', value: 'bottom' }
                ],
                v1customCode: true,
                version: '0.6.4+'
            },
            detailWorldMapPosition: {
                label: '详情页地图位置',
                placeholder: '请选择详情页地图位置',
                remark: '详情页地图位置',
                type: 'select',
                options: [
                    { label: '顶部(top)', value: 'top' },
                    { label: '底部(bottom)', value: 'bottom' }
                ],
                v1customCode: true,
                version: '0.6.4+'
            },
            hideNavbarServerCount: {
                label: '隐藏服务器数量',
                type: 'switch',
                remark: '隐藏导航栏的服务器数量统计',
                v1customCode: true
            },
            hideNavbarServerStat: {
                label: '隐藏服务器统计',
                type: 'switch',
                remark: '隐藏导航栏的服务器统计信息',
                v1customCode: true
            },
            hideListItemStatusDonut: {
                label: '隐藏列表饼图',
                remark: '隐藏列表项的状态饼图，不影响详情页的状态饼图',
                type: 'switch',
                v1customCode: true
            },
            hideListItemStat: {
                label: '隐藏列表统计',
                remark: '隐藏列表项的统计信息，不影响详情页的统计信息',
                type: 'switch',
                v1customCode: true
            },
            hideListItemBill: {
                label: '隐藏列表账单',
                remark: '隐藏列表项的账单信息，不影响详情页的账单信息',
                type: 'switch',
                v1customCode: true
            },
            hideFilter: {
                label: '隐藏筛选',
                remark: '隐藏列表页的标签和在线/离线筛选功能',
                type: 'switch',
                v1customCode: true
            },
            hideTag: {
                label: '隐藏标签',
                remark: '隐藏列表项的标签筛选功能',
                type: 'switch',
                v1customCode: true
            },
            hideDotBG: {
                label: '隐藏点阵背景',
                type: 'switch',
                remark: '隐藏盒子里面的点阵背景',
                v1customCode: true
            },
            monitorRefreshTime: {
                label: '监控刷新时间',
                placeholder: '请输入监控刷新时间',
                remark: '监控刷新时间间隔，单位s（秒）, 0为不刷新，为保证不频繁请求源站，最低生效值为10s',
                type: 'input',
                v1customCode: true,
                version: '0.4.8+'
            },
            monitorChartType: {
                label: '监控图表类型',
                placeholder: '请选择监控图表类型',
                remark: '监控图表类型，single单独显示/multi聚合在一起',
                type: 'select',
                options: [
                    { label: '单个(single)', value: 'single' },
                    { label: '多个(multi)', value: 'multi' }
                ],
                v1customCode: true,
                version: '0.6.4+'
            },
            monitorChartTypeToggle: {
                label: '监控图表类型切换',
                type: 'switch',
                remark: '启用监控图表类型切换',
                v1customCode: true,
                version: '0.6.4+'
            },
            filterGPUKeywords: {
                label: 'GPU过滤关键字',
                placeholder: '请输入GPU过滤关键字',
                remark: '按下Enter键(回车)确定关键词；如果GPU名称中包含这些关键字，则过滤掉',
                type: 'input-tag',
                v1customCode: true,
                version: '0.4.9+'
            },
            nezhaVersion: {
                label: '哪吒版本',
                placeholder: '请选择哪吒版本',
                remark: '哪吒探针的版本，目前仅支持v0和v1，0.4.13前默认为v0，0.4.13后默认为自动处理',
                type: 'select',
                options: [
                    { label: 'v0 - 默认', value: 'v0' },
                    { label: 'v1', value: 'v1' }
                ]
            },
            apiMonitorPath: {
                label: '监控API地址',
                placeholder: '请输入网络服务监控API路径',
                remark: '主要是网络服务那个监控数据的读取，目前只会替换关键词 {id}',
                type: 'input'
            },
            wsPath: {
                label: 'WebSocket地址',
                placeholder: '请输入WebSocket路径',
                remark: 'WebSocket连接路径',
                type: 'input'
            },
            nezhaPath: {
                label: '哪吒路径',
                placeholder: '请输入哪吒路径',
                remark: '哪吒探针的路径',
                type: 'input'
            },
            nezhaV0ConfigType: {
                label: '哪吒v0数据读取类型',
                placeholder: '请选择哪吒v0数据读取类型',
                remark: '哪吒v0数据读取类型',
                type: 'select',
                options: [
                    { label: 'servers', value: 'servers' }
                ]
            },
            v1ApiMonitorPath: {
                label: 'v1监控API地址',
                placeholder: '请输入v1监控API路径',
                remark: 'v1版本的监控API',
                type: 'input'
            },
            v1WsPath: {
                label: 'v1 WebSocket地址',
                placeholder: '请输入v1 WebSocket路径',
                remark: 'v1版本的WebSocket连接路径',
                type: 'input'
            },
            v1ApiGroupPath: {
                label: 'v1分组API地址',
                placeholder: '请输入v1分组API路径',
                remark: 'v1版本的分组API',
                type: 'input'
            },
            v1ApiSettingPath: {
                label: 'v1设置API地址',
                placeholder: '请输入v1设置API路径',
                remark: 'v1版本的设置API',
                type: 'input'
            },
            v1ApiProfilePath: {
                label: 'v1用户信息地址',
                placeholder: '请输入v1用户信息API路径',
                remark: 'v1版本的用户信息API',
                type: 'input'
            },
            v1DashboardUrl: {
                label: 'v1控制台地址',
                placeholder: '请输入v1控制台地址',
                remark: 'v1版本的控制台地址，默认为 /dashboard',
                type: 'input',
                v1customCode: true
            },
            v1HideNezhaDashboardBtn: {
                label: '隐藏控制台按钮',
                type: 'switch',
                remark: '隐藏导航栏的控制台入口/登录按钮',
                v1customCode: true
            },
            routeMode: {
                label: '路由模式',
                placeholder: '请选择路由模式',
                remark: '默认为h5，如果是hash模式，需要后端支持',
                type: 'select',
                options: [
                    { label: 'h5', value: 'h5' },
                    { label: 'hash', value: 'hash' }
                ]
            }
        };

        // 全局状态
        let configFormData = {};
        let configFieldEnable = {};
        let isV1CustomCode = false;

        // 初始化
        function init() {
            // 加载本地存储的配置
            loadLocalConfig();
            
            // 渲染表单
            renderForm();
            
            // 绑定V1开关事件
            document.getElementById('v1CustomCode').addEventListener('change', function() {
                isV1CustomCode = this.checked;
                saveLocalConfig();
                renderForm();
                updateCodeOutput();
            });
            
            // 初始更新代码输出
            updateCodeOutput();
        }

        // 加载本地配置
        function loadLocalConfig() {
            const localData = localStorage.getItem('nazhua-custom-config');
            if (localData) {
                try {
                    const data = JSON.parse(localData);
                    configFormData = data.formData || {};
                    configFieldEnable = data.enable || {};
                } catch (e) {
                    console.error('加载本地配置失败:', e);
                }
            }
            
            // 初始化默认值
            Object.keys(configTemplate).forEach(key => {
                if (!(key in configFormData)) {
                    configFormData[key] = configTemplate[key];
                }
                if (!(key in configFieldEnable)) {
                    configFieldEnable[key] = false;
                }
            });
            
            // 加载V1开关状态
            const v1State = localStorage.getItem('nezha-generator-v1CustomCode');
            isV1CustomCode = v1State === '1';
            document.getElementById('v1CustomCode').checked = isV1CustomCode;
        }

        // 保存本地配置
        function saveLocalConfig() {
            const data = {
                formData: configFormData,
                enable: configFieldEnable
            };
            localStorage.setItem('nazhua-custom-config', JSON.stringify(data));
            localStorage.setItem('nezha-generator-v1CustomCode', isV1CustomCode ? '1' : '0');
        }

        // 渲染表单
        function renderForm() {
            const formContainer = document.getElementById('configForm');
            formContainer.innerHTML = '';
            
            Object.keys(fieldLabels).forEach(key => {
                const field = fieldLabels[key];
                
                // 如果是V1模式且字段不支持V1，则跳过
                if (isV1CustomCode && !field.v1customCode) {
                    return;
                }
                
                const formItem = createFormItem(key, field);
                formContainer.appendChild(formItem);
            });
        }

        // 创建表单项
        function createFormItem(key, field) {
            const formItem = document.createElement('div');
            formItem.className = 'form-item';
            
            // 标签
            const label = document.createElement('div');
            label.className = 'form-label';
            label.innerHTML = field.label + (field.version ? `<span class="version-tag">${field.version}</span>` : '');
            
            // 内容区域
            const content = document.createElement('div');
            content.className = 'form-content';
            
            // 启用开关
            const switchContainer = document.createElement('div');
            switchContainer.className = 'enable-switch';
            const switchLabel = document.createElement('label');
            switchLabel.className = 'switch';
            const switchInput = document.createElement('input');
            switchInput.type = 'checkbox';
            switchInput.checked = configFieldEnable[key];
            switchInput.addEventListener('change', function() {
                configFieldEnable[key] = this.checked;
                saveLocalConfig();
                updateCodeOutput();
            });
            const switchSlider = document.createElement('span');
            switchSlider.className = 'slider';
            switchLabel.appendChild(switchInput);
            switchLabel.appendChild(switchSlider);
            switchContainer.appendChild(switchLabel);
            
            // 控件容器
            const controlContainer = document.createElement('div');
            controlContainer.className = 'form-control';
            
            // 根据类型创建控件
            let control;
            if (field.type === 'input') {
                control = document.createElement('input');
                control.className = 'input';
                control.type = 'text';
                control.placeholder = field.placeholder || '';
                control.value = configFormData[key] || '';
                control.addEventListener('input', function() {
                    configFormData[key] = this.value;
                    saveLocalConfig();
                    updateCodeOutput();
                });
            } else if (field.type === 'select') {
                control = document.createElement('select');
                control.className = 'select';
                field.options.forEach(option => {
                    const optionEl = document.createElement('option');
                    optionEl.value = option.value;
                    optionEl.textContent = option.label;
                    control.appendChild(optionEl);
                });
                control.value = configFormData[key] || '';
                control.addEventListener('change', function() {
                    configFormData[key] = this.value;
                    saveLocalConfig();
                    updateCodeOutput();
                });
            } else if (field.type === 'switch') {
                control = document.createElement('label');
                control.className = 'switch';
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.checked = configFormData[key] || false;
                input.addEventListener('change', function() {
                    configFormData[key] = this.checked;
                    saveLocalConfig();
                    updateCodeOutput();
                });
                const slider = document.createElement('span');
                slider.className = 'slider';
                control.appendChild(input);
                control.appendChild(slider);
            } else if (field.type === 'input-tag') {
                control = createTagInput(key, field);
            }
            
            controlContainer.appendChild(control);
            
            content.appendChild(switchContainer);
            content.appendChild(controlContainer);
            
            // 备注
            if (field.remark) {
                const remark = document.createElement('div');
                remark.className = 'remark';
                remark.textContent = 'Tips: ' + field.remark;
                content.appendChild(remark);
            }
            
            formItem.appendChild(label);
            formItem.appendChild(content);
            
            return formItem;
        }

        // 创建标签输入控件
        function createTagInput(key, field) {
            const container = document.createElement('div');
            container.className = 'tag-input';
            
            const tags = configFormData[key] || [];
            
            function renderTags() {
                container.innerHTML = '';
                
                tags.forEach((tag, index) => {
                    const tagEl = document.createElement('span');
                    tagEl.className = 'tag';
                    tagEl.innerHTML = `${tag} <span class="tag-remove" onclick="removeTag('${key}', ${index})">&times;</span>`;
                    container.appendChild(tagEl);
                });
                
                const input = document.createElement('input');
                input.placeholder = field.placeholder || '';
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && this.value.trim()) {
                        tags.push(this.value.trim());
                        configFormData[key] = tags;
                        saveLocalConfig();
                        updateCodeOutput();
                        renderTags();
                    }
                });
                container.appendChild(input);
            }
            
            renderTags();
            return container;
        }

        // 移除标签
        function removeTag(key, index) {
            const tags = configFormData[key] || [];
            tags.splice(index, 1);
            configFormData[key] = tags;
            saveLocalConfig();
            updateCodeOutput();
            renderForm(); // 重新渲染表单
        }

        // 更新代码输出
        function updateCodeOutput() {
            const enabledConfig = {};
            
            Object.keys(fieldLabels).forEach(key => {
                const field = fieldLabels[key];
                
                // 如果是V1模式且字段不支持V1，则跳过
                if (isV1CustomCode && !field.v1customCode) {
                    return;
                }
                
                if (configFieldEnable[key]) {
                    enabledConfig[key] = configFormData[key];
                }
            });
            
            let code;
            if (isV1CustomCode) {
                code = `window.$mergeNazhuaConfig && window.$mergeNazhuaConfig(${JSON.stringify(enabledConfig, null, 2)})`;
            } else {
                code = `window.$$nazhuaConfig = ${JSON.stringify(enabledConfig, null, 2)}`;
            }
            
            document.getElementById('codeOutput').textContent = code;
        }

        // 重置配置
        function resetConfig() {
            if (confirm('确定要还原默认配置吗？')) {
                configFormData = { ...configTemplate };
                configFieldEnable = {};
                Object.keys(configTemplate).forEach(key => {
                    configFieldEnable[key] = false;
                });
                saveLocalConfig();
                renderForm();
                updateCodeOutput();
            }
        }

        // 显示导入对话框
        function showImportDialog() {
            document.getElementById('importText').value = '';
            document.getElementById('importModal').classList.add('show');
        }

        // 隐藏导入对话框
        function hideImportDialog() {
            document.getElementById('importModal').classList.remove('show');
        }

        // 导入配置
        function importConfig() {
            const configText = document.getElementById('importText').value.trim();
            if (!configText) {
                alert('请输入配置代码');
                return;
            }
            
            try {
                let configObj = null;
                
                // 提取配置对象
                const configMatch1 = configText.match(/window\.\$\$nazhuaConfig\s*=\s*(\{[\s\S]*\})/);
                const configMatch2 = configText.match(/window\.\$mergeNazhuaConfig\s*&&\s*window\.\$mergeNazhuaConfig\s*\((\{[\s\S]*\})\)/);
                
                if (configMatch1 && configMatch1[1]) {
                    configObj = (new Function(`return ${configMatch1[1]}`))();
                } else if (configMatch2 && configMatch2[1]) {
                    configObj = (new Function(`return ${configMatch2[1]}`))();
                } else {
                    alert('配置格式不正确，请检查');
                    return;
                }
                
                // 更新配置
                Object.keys(configObj).forEach(key => {
                    if (key in configFormData) {
                        configFormData[key] = configObj[key];
                        configFieldEnable[key] = true;
                    }
                });
                
                saveLocalConfig();
                renderForm();
                updateCodeOutput();
                hideImportDialog();
                alert('配置导入成功');
            } catch (error) {
                console.error('导入配置失败:', error);
                alert('配置导入失败，请检查配置格式是否正确');
            }
        }

        // 复制代码
        function copyCode() {
            const codeOutput = document.getElementById('codeOutput');
            const textArea = document.createElement('textarea');
            textArea.value = codeOutput.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('代码已复制到剪贴板');
        }

        // 点击模态框外部关闭
        document.getElementById('importModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideImportDialog();
            }
        });

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>